# Synapse

**Synapse** is a security-focused, production-oriented backend system designed to demonstrate **transactional integrity, least-privilege architecture, and complex LLM tool-calling** in a modern async environment.

The system is built as a hardened core where AI capabilities‚Äîsuch as Retrieval-Augmented Generation (RAG) and Agentic Task Management‚Äîare integrated as modular layers on top of a stable, ACID-compliant foundation.

---

## üöÄ Key Capabilities

### 1. Advanced AI & Agentic Integration
A fully realized **Agentic Tool Loop** and RAG pipeline using Google Gemini 3.0.
- **Deterministic Tool Calling:** Bridges natural language intent with strict database schemas, ensuring AI "hallucinations" are caught and handled at the Pydantic validation layer.
- **Thought Signature Management:** Explicitly handles the "thought" or "reasoning" signatures generated by Gemini 3.0 Thinking models. The system includes a robust fallback mechanism: if a tool call fails, the reasoning signatures are stripped from the retry prompt to ensure a clean, state-free recovery attempt.
- **Self-Correcting Reasoning:** The agent performs autonomous diagnostic "read" operations to resolve "not found" errors, retrying operations with corrected parameters.
- **Fuzzy-to-Strict Resolver:** Translates imprecise user input into precise primary key operations using optimized `ILIKE` strategies for case-insensitive matching.
- **Isolated RAG Identifiers:** Real database UUIDs are never exposed to the vector store (Qdrant); an abstraction layer maps internal IDs to vector-safe identifiers to prevent leakage.



### 2. Security-First Architecture
Built with the principle of least exposure, leveraging **HashiCorp Vault** for all sensitive operations.
- **Zero-Trust Secret Management:** The application starts with zero knowledge of its environment, dynamically obtaining identity-bound credentials via **AppRole**.
- **Dynamic Credentials:** Database access is granted via short-lived leases that are rotated and revoked automatically, significantly reducing the blast radius of a potential leak.
- **Transit Engine:** JWT signing is handled via Vault‚Äôs asymmetric Transit engine; private keys never reside in API memory or environment files.

---

## üèóÔ∏è Architectural Decisions

### Database Lease Management
- **Implementation:** Vault revokes database credentials frequently to maintain a high security posture. 
- **Production Improvement:** In a high-scale environment, this would be further improved such that the database lease is automatically renewed when approaching expiration. This ensures that long-running LLM reasoning chains or complex database operations are never left unfinished, while maintaining strict security boundaries.



### Contextual Session & History
- **Server-Side History Aggregation:** Instead of the client sending full chat history, the backend utilizes the `conversation_id` to automatically retrieve, format, and inject history into the LLM context. This ensures data integrity and minimizes network overhead.
- **Global User Isolation:** Tasks are searchable globally by `user_id` ensuring strict row-level isolation. One user cannot look up or modify the tasks of another user, regardless of the conversation context.
- **Database:** For this portfolio iteration, the conversation_id is stored as a field within the ChatMessage table to simplify history retrieval.In a full-scale production system, a dedicated Conversations table would be implemented. This would allow for more robust metadata storage (e.g., session titles, participant lists, and analytics) and more.

---

## üõ†Ô∏è Tech Stack

- **API**: Async FastAPI
- **Database**: PostgreSQL (async SQLAlchemy 2.0 + Alembic)
- **Secrets Management**: HashiCorp Vault (KV v2, AppRole, Transit)
- **Vector Database**: Qdrant
- **AI Integration**: Google Gemini 3.0 (Thinking) & 2.5 Flash (Tooling)
- **Security**: Argon2id (Hashing), JWT (Vault-signed)
- **Runtime**: Docker-based local development

---

## üìä Project Integrity

Synapse showcases proficiency in modern backend engineering:
- **Transactional Correctness:** Ensures even complex, multi-step AI workflows follow ACID principles. If a tool execution fails or provides invalid parameters, the system guarantees a clean rollback, preventing partial state corruption.
- **System Boundaries:** PostgreSQL remains the authoritative source of truth, while Qdrant is treated as a **derived vector index**, keeping the core data model decoupled from the vector representation.

## License
Provided for educational and portfolio purposes.